	.include 'dpf.inc'

	.area LCDAUX (CODE)

_lcd_custom_init::
	mov	p3dir,#0x0
	anl	p1dir,#0xe8
	anl	p2dir,#0xfd
	anl	p2,#0xfd
	orl	p2,#0x8
	lcall	X1502
	lcall	X1502
	lcall	X1502
	lcall	X1502
	lcall	X1502
	anl	p1,#0xfe
	lcall	X1502
	lcall	X1502
	lcall	X1502
	lcall	X1502
	lcall	X1502
	lcall	X1502
	lcall	X1502
	lcall	X1502
	orl	p1,#0x1
	mov	dptr,#_custom_initseq
	ljmp	_lcd_init_by_table

X1502:	mov	r7,#0
X1504:	nop
	djnz	r7,X1504
	ret

;
; If custom backlight handling is needed, uncomment the following label
; and set LCD_BACKLIGHT_CUSTOM in dpfmodel.h
; r3 contains brightness value (0 .. LCD_MAX_BRIGHTNESS_VALUE)
;
;_lcd_custom_setbacklight::

;
; If custom contrast handling is needed, uncomment the following label
; and set LCD_CONTRAST_CUSTOM in dpfmodel.h
; r3 contains contrast value (1 .. LCD_MAX_CONTRAST_VALUE)
;
;_lcd_custom_setcontrast::

	.area LCDAUX (CODE)


;backlight_table::
;	.db	If needed, put data for custom backlight handling here
;_custom_backlighttbl_len::  .db  . - backlight_table


;contrast_table::
;	.db	If needed, put data for custom contrast handling here
;_custom_contrasttbl_len::  .db  . - contrast_table

; Contrast table from original firmware is useless. Values are all the same,
; and commands are 0x00, which should be NOP for the LCD controller.
; Original firmware has no contrast adjustment.
_custom_contrasttbl::
	.db	0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10
_custom_contrasttbl_len::  .db  7

_custom_contrasttbl2::
	.db	0x71, 0x00, 0x71, 0x00, 0x91, 0x00, 0x91, 0x00, 0xff
_custom_contrasttbl2_len::  .db  9

_custom_contrasttbl2_offsets::
	.db	0x07
_custom_contrasttbl2_offsets_len::  .db  1

_custom_backlighttbl::
; This is based on the sRGB curve
	.db	0x01, 0x02, 0x04, 0x08, 0x0c, 0x11, 0x17, 0x1e, 0x27, 0x31
	.db	0x3c, 0x48, 0x56, 0x67, 0x77, 0x8a, 0x9d, 0xb3, 0xca, 0xe2
	.db	0xff
; This is from original firmware, but is unused there.
; Original firmware turns on the backlight 100% via the port
; registers, without PWM.
;	.db	0x2e, 0x32, 0x36, 0x3a, 0x3e, 0x42, 0x46, 0x4a, 0x4e, 0x52
;	.db	0x56, 0x5a, 0x5e, 0x62, 0x66, 0x6a, 0x6e, 0x72, 0x76, 0x7a
;	.db	0x7e
_custom_backlighttbl_len::  .db  21

_custom_backlighttbl2::
_custom_backlighttbl2_len::  .db  0

_custom_initseq::
; Similar to Ilitek ILI9341, but command b6h has 2 parameters, not 4.
	.db 0x00
	.db 0xb0, 0x64
	.db 0x11
	.db 0xb0, 0x0a
	.db 0x10
	.db 0xb0, 0x64
	.db 0x11
	.db 0xb0, 0x78
	; Power control B
	.db 0x71, 0xcf, 0x91, 0x00, 0x91, 0xc1, 0x91, 0x30
	; Power on sequence control
	.db 0x71, 0xed, 0x91, 0x64, 0x91, 0x03, 0x91, 0x12, 0x91, 0x81
	; Driver timing control A
	.db 0x71, 0xe8, 0x91, 0x85, 0x91, 0x00, 0x91, 0x79
	; Power control A
	.db 0x71, 0xcb, 0x91, 0x39, 0x91, 0x2c, 0x91, 0x00, 0x91, 0x34, 0x91, 0x02
	; Pump ratio control
	.db 0x71, 0xf7, 0x91, 0x20
	; Driver timing control B
	.db 0x71, 0xea, 0x91, 0x00, 0x91, 0x00
	; Power Control 1
	.db 0x71, 0xc0, 0x91, 0x3f
	; Power Control 2
	.db 0x71, 0xc1, 0x91, 0x12
	; VCOM Control 1
	.db 0x71, 0xc5, 0x91, 0x20, 0x91, 0x3f
	; VCOM Control 2
	.db 0x71, 0xc7, 0x91, 0x85
	; Pixel Format Set
	.db 0x71, 0x3a, 0x91, 0x55
	; Memory Access Control
	.db 0x71, 0x36, 0x91, 0x68
	; Frame Rate Control (In Normal Mode/Full Colors)
	.db 0x71, 0xb1, 0x91, 0x00, 0x91, 0x17
	; Display Function Control
	.db 0x71, 0xb6, 0x91, 0x0a, 0x91, 0xa2
	; Gamma Set
	.db 0x71, 0x26, 0x91, 0x01
	; Positive Gamma Correction
	.db 0x71, 0xe0, 0x91, 0x0f, 0x91, 0x15, 0x91, 0x1c, 0x91, 0x1b, 0x91
	.db 0x08, 0x91, 0x0f, 0x91, 0x48, 0x91, 0xb8, 0x91, 0x34, 0x91, 0x00
	.db 0x91, 0x0f, 0x91, 0x01, 0x91, 0x0f, 0x91, 0x0c, 0x91, 0x00
	; Negative Gamma Correction
	.db 0x71, 0xe1, 0x91, 0x00, 0x91, 0x2a, 0x91, 0x24, 0x91, 0x07, 0x91
	.db 0x10, 0x91, 0x07, 0x91, 0x38, 0x91, 0x47, 0x91, 0x4b, 0x91, 0x0f
	.db 0x91, 0x10, 0x91, 0x0e, 0x91, 0x30, 0x91, 0x33, 0x91, 0x0f
	; Sleep Out
	.db 0x71, 0x11
	.db 0xb0, 0x78
	; Display ON
	.db 0x71, 0x29
	.db 0xff
_custom_initseq_len::  .db  173
